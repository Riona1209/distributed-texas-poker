<!doctype html>
<html>

<head>
	<link href="css/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection" />
	<link href="css/index.css" type="text/css" rel="stylesheet" media="screen,projection" />
</head>

<body>
	<div class="valign-wrapper row login-box">
		<div class="col card hoverable s12 m4">
			<form>
				<div class="card-content">
					<span class="card-title black-text">Texas Hold &apos;Em Poker - Distributed</span>
					<p>Welcome to Texas Hold &apos;Em Poker!</p>
				</div>
				<div class="card-action right-align">
					<a class="btn-large waves-effect waves-light indigo darken-3 white-text modal-trigger" href="#hostModal">Host
						Game</a>
					<a class="btn-large waves-effect waves-light indigo darken-3 white-text modal-trigger" href="#joinModal">Join
						Game</a>
				</div>
			</form>
		</div>
	</div>

	<div id="hostModal" class="modal">
		<div class="modal-content">
			<h4>Host Game</h4>
			<div id="hostModalContent">
				<p>Enter your name, and then we'll give you a code which you can give to your friends as the host.</p>
				<div class="input-field col s12">
					<label for="name">Name</label>
					<input type="text" name="name" id="hostName-field" required />
				</div>
				<button onclick=beginHost() type="submit"
					class="waves-effect waves-light indigo darken-3 white-text btn-flat">Get
					Code</button>
			</div>
			<div id="playersNames"></div>
			<div id="startGameArea"></div>
		</div>
		<div class="modal-footer">
			<a class="modal-close waves-effect waves-light btn-flat">CLOSE</a>
		</div>
	</div>
	</div>

	<div id="joinModal" class="modal">
		<div class="modal-content">
			<h4>Join Game</h4>
			<div id="joinModalContent">
				<p>Enter the your name and the code provided by the host to join their room:</p>
				<div class="input-field col s12">
					<label for="name">Name</label>
					<input type="text" name="name" id="joinName-field" required="required" />
				</div>
				<div class="input-field col s12">
					<label for="code">Code</label>
					<input type="text" name="code" id="code-field" required="required" />
				</div>
				<button onclick=joinRoom() type="submit"
					class="waves-effect waves-light indigo darken-3 white-text btn-flat">Join
					Game</button>
			</div>
			<div id="playersNamesJoined"></div>
		</div>
		<div class="modal-footer">
			<a href="#!" class="modal-close waves-effect waves-light btn-flat">CLOSE</a>
		</div>
	</div>
	<footer class="page-footer white">
		<div class="container footer-c">
			<b>Â© 2020 - Peter Wu.</b><br><br>
	</footer>

	<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.5.0/socket.io.min.js"></script>
	<script src="js/main.js"> </script>
	<script src="js/materialize.min.js"></script>
	<script>
		var socket = io('http://localhost:3000');
		var gameInfo = null;

		socket.on("hostRoom", function (data) {
			if (data.players.length >= 11) {
				$('#hostModalContent').html('<h5>Code:</h5><code>' + data.code + '</code><br /><h5>Warning: you have too many players in your room. Max is 11.</h5><h5>Players Currently in My Room</h5>');
				$('#playersNames').html(data.players.map(function (p) {
					return '<span>' + p + '</span><br />';
				}));
			} else if (data.players.length > 1) {
				$('#hostModalContent').html('<h5>Code:</h5><code>' + data.code + '</code><br /><h5>Players Currently in My Room</h5>');
				$('#playersNames').html(data.players.map(function (p) {
					return '<span>' + p + '</span><br />';
				}));
				$('#startGameArea').html('<br /><button onclick=startGame(' + data.code + ') type="submit" class= "waves-effect waves-light green darken-3 white-text btn-flat">Start Game</button >');
			} else {
				$('#hostModalContent').html('<h5>Code:</h5><code>' + data.code + '</code><br /><h5>Players Currently in My Room</h5>');
				$('#playersNames').html(data.players.map(function (p) {
					return '<span>' + p + '</span><br />';
				}));
			}

		});

		socket.on("joinRoom", function (data) {
			if (data == undefined) {
				alert('Invalid code! Not sure if that room exists.');
			} else {
				$('#joinModalContent').html('<h5>' + data.host + '\'s room</h5><hr /><h5>Players Currently in Room</h5><p>Please wait until your host starts the game.</p>');
				$('#playersNamesJoined').html(data.players.map(function (p) {
					return '<span>' + p + '</span><br />';
				}));
			}
		});

		socket.on("gameBegin", function (data) {
			if (data == undefined) {
				alert('Error - invalid game.');
			}
			$('#hostModal').closeModal();
			$('#joinModal').closeModal();
		});

		var beginHost = function () {
			if ($('#hostName-field').val() == "") {
				alert('Enter a valid name!');
			} else {
				socket.emit('host', { username: $('#hostName-field').val() });
			}
		}

		var joinRoom = function () {
			if ($('#joinName-field').val() == "" || $('#code-field').val() == "") {
				alert('Enter a valid name/code!');
			} else {
				socket.emit('join', { code: $('#code-field').val(), username: $('#joinName-field').val() });
			}
		}

		var startGame = function (gameCode) {
			socket.emit('startGame', { code: gameCode });
		}

		$(document).ready(function () {
			$('.modal-trigger').leanModal();
		});

	</script>

</body>

</html>